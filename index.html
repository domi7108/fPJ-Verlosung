<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Meditickets Gewinnspiel</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 10px; line-height: 1.4; }
    input, button, textarea { width: 100%; padding: 10px; margin: 8px 0; font-size: 1rem; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    button { cursor: pointer; }
    .small { font-size: 0.9rem; color: #555; }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>
<h2>Willkommen zum Meditickets Gewinnspiel!</h2>
<p>
  Für alle Studis aus Tübingen, die zur fPJ Demo gekommen sind!!<br><br>
  <strong>Bitte beachten:</strong><br>
  - Nur Medizinstudierende der Uni Tübingen können teilnehmen.<br>
  - Umfrage vor Ort bei der Demo ausfüllen (GPS wird einmalig abgefragt).<br>
  - Unbedingt GPS anschalten und im Browser den Standortzugriff zulassen <br>
  - Gewinner werden per Mail benachrichtigt.<br><br>
  Danke, dass ihr euch für ein faires PJ stark macht!<br><br>
  Falls widerholt eine Fehlermeldung kommt, gerne eine Mail schreiben an d.hosek@fachschaftmedizin.de
</p>

<form id="form">
  <label>Vorname</label>
  <input name="first_name" type="text" required placeholder="Max">

  <label>Nachname</label>
  <input name="last_name" type="text" required placeholder="Mustermann">

  <label>Studentische Mailadresse (@student.uni-tuebingen.de)</label>
  <input name="email" type="email" required placeholder="max@student.uni-tuebingen.de">

  <input type="hidden" name="lat">
  <input type="hidden" name="lon">

  <label>
    <input type="checkbox" name="terms" required>
    Ich habe die Teilnahmebedingungen gelesen und akzeptiere, dass nur eine Teilnahme pro Person erlaubt ist. Falls wir von einem Gerät verschiedene Namen registrieren, kann dies zu einem Ausschluss vom Gewinnspiel führen.
  </label>

  <label>
    <input type="checkbox" name="consent" required>
    Ich willige ein, dass meine Angaben (Name, studentische E‑Mail) und mein Standort (Koordinaten, Zeitpunkt) zur Prüfung meiner Anwesenheit und zur Durchführung der Verlosung verarbeitet werden. Die Daten werden ausschließlich für die Verlosung verwendet und spätestens 30 Tage nach Veranstaltung gelöscht. Verantwortliche Stelle: Dominik Hosek, d.hosek@fachschaftmedizin.de. Ich kann meine Einwilligung jederzeit widerrufen.
  </label>

  <button type="submit">Senden</button>
  <p id="status" class="small"></p>
</form>

<script>
const statusEl = document.getElementById("status");
const form = document.getElementById("form");

form.addEventListener("submit", e => {
  e.preventDefault();
  statusEl.textContent = "GPS wird abgefragt...";

  const sendData = () => {
    const data = new FormData(form);
    fetch("https://script.google.com/macros/s/AKfycbxv_5oHmDR6qyT69U0mcDg-Jzwz9UMKQWBgNM4Fjs7-7Hf4b4IalHn1_Pax7kcR0wPe/exec", {  // <-- hier Web-App URL einfügen
      method: "POST",
      body: data
    })
    .then(resp => resp.text())  // als Text auslesen, kein JSON parsing nötig
    .then(result => {
      statusEl.textContent = "Gesendet! Danke für deine Teilnahme.";
      form.reset();
    })
    .catch(err => {
      // Daten wurden trotzdem gespeichert
      statusEl.textContent = "Gesendet! Danke dir für deine Teilnahme".;
      console.error(err);
    });
  };

  if (!navigator.geolocation) {
    statusEl.textContent = "GPS wird vom Browser nicht unterstützt. Restliche Daten werden trotzdem gespeichert. Evtl.nochmal GPS aktivieren und im Browser zulassen, dann erneut auf Senden";
    sendData();
  } else {
    navigator.geolocation.getCurrentPosition(
      pos => {
        form.lat.value = pos.coords.latitude;
        form.lon.value = pos.coords.longitude;
        sendData();
      },
      err => {
        statusEl.innerHTML = '<span class="error">GPS konnte nicht erfasst werden. Daten werden trotzdem gespeichert.</span>';
        sendData();
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  }
});
</script>
</body>
</html>
